<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>PDF for Humans — Modules</title>
    <style>
        :root{
            --bg:#0f1720; --card:#111827; --muted:#9aa4b2; --accent:#7c3aed; --glass: rgba(255,255,255,0.03);
            color-scheme: dark;
        }
        *{box-sizing:border-box}
        html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;color:#e6eef8;background:linear-gradient(180deg,#071021 0%, #071426 100%);}
        .app{display:grid;grid-template-columns:260px 1fr;gap:20px;height:100vh;padding:20px}
        .sidebar{background:var(--card);border-radius:12px;padding:18px;display:flex;flex-direction:column;gap:12px;min-height:0}
        .brand{display:flex;gap:12px;align-items:center}
        .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#4f46e5);display:flex;align-items:center;justify-content:center;font-weight:700;color:white}
        h1{font-size:16px;margin:0}
        p.sub{color:var(--muted);margin:0;font-size:12px}
        .nav{display:flex;flex-direction:column;gap:6px;margin-top:6px;overflow:auto;padding-right:6px}
        .nav button{appearance:none;border:0;background:transparent;padding:10px;border-radius:8px;color:var(--muted);text-align:left;display:flex;gap:10px;align-items:center;cursor:pointer}
        .nav button.active{background:linear-gradient(90deg,rgba(124,58,237,0.12),transparent);color:#eaf2ff}
        .nav svg{opacity:.9}
        .main{display:flex;flex-direction:column;gap:16px;min-width:0}
        .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px}
        .controls{display:flex;gap:8px;align-items:center}
        .btn{background:var(--glass);border:1px solid rgba(255,255,255,0.03);padding:8px 12px;border-radius:10px;color:#dcebf9;cursor:pointer}
        .drop{flex:1;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:12px;padding:14px;border:1px dashed rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:10px;align-items:flex-start;min-height:84px}
        .modules-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
        .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:12px;border-radius:10px;color:#eaf2ff;display:flex;flex-direction:column;gap:8px}
        .card small{color:var(--muted)}
        .stage{background:var(--card);border-radius:12px;padding:12px;flex:1;min-height:0;display:flex;flex-direction:column}
        .iframe-wrap{background:#051021;border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,0.03);flex:1;display:flex;min-height:0}
        iframe{width:100%;height:100%;border:0;display:block}
        .footer{color:var(--muted);font-size:12px;padding-top:6px}
        input[type=file]{display:none}
        @media (max-width:900px){
            .app{grid-template-columns:1fr; padding:14px}
            .sidebar{order:2}
        }
    </style>
</head>
<body>
    <div class="app">
        <aside class="sidebar" aria-label="Modules">
            <div class="brand">
                <div class="logo">PDF</div>
                <div>
                    <h1>PDF for Humans</h1>
                    <p class="sub">modular PDF tools</p>
                </div>
            </div>

            <div style="margin-top:6px" class="controls">
                <label class="btn" for="file">Upload PDF</label>
                <input id="file" type="file" accept="application/pdf" />
                <button class="btn" id="toggle-theme" title="Toggle theme">Theme</button>
            </div>

            <nav class="nav" id="modules">
                <button data-module="divisor" class="active" title="Split pages into new files">
                    <!-- svg icon -->
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
                    Divisor
                </button>
                <button data-module="merger" title="Merge multiple PDFs">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 7h18v10H3z" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/></svg>
                    Merger
                </button>
                <button data-module="compressor" title="Compress files">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 3v18M3 12h18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
                    Compressor
                </button>
                <button data-module="editor" title="Edit pages, annotate">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 21l6-6 9-9 3 3-9 9-6 6H3z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    Editor
                </button>
                <button data-module="signer" title="Sign PDF">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 12h18M8 8l5 8 3-4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    Signer
                </button>
                <button data-module="ocr" title="OCR / extract text">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 6h16M4 18h16M9 6v12" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    OCR
                </button>
                <button data-module="metadata" title="Edit metadata">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2v20M2 12h20" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
                    Metadata
                </button>
            </nav>

            <div class="footer">Submodules are kept in ./submodules/*.html — click a module to load it</div>
        </aside>

        <main class="main">
            <div class="topbar">
                <div style="display:flex;gap:12px;align-items:center;flex:1">
                    <div class="drop" id="dropzone" aria-label="Drop PDF here">
                        <div style="display:flex;justify-content:space-between;align-items:center;width:100%">
                            <div>
                                <strong id="file-name">No file selected</strong>
                                <div class="sub" style="margin-top:4px">Drag & drop a PDF or use Upload</div>
                            </div>
                            <div style="display:flex;gap:8px;align-items:center">
                                <button class="btn" id="clear-file">Clear</button>
                                <button class="btn" id="open-in-new" title="Open module in a new window">Open</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="controls">
                    <div class="sub">Active module:</div>
                    <div id="activeModule" style="min-width:120px;text-align:right;font-weight:600;color:#eaf2ff">Divisor</div>
                </div>
            </div>

            <section class="stage">
                <div class="modules-grid" style="margin-bottom:10px">
                    <div class="card">
                        <div style="display:flex;justify-content:space-between;align-items:center">
                            <strong>Quick actions</strong>
                        </div>
                        <small>Open the selected module in the panel or a new window. Modules receive uploaded PDF via postMessage (object URL).</small>
                        <div style="display:flex;gap:8px;margin-top:8px">
                            <button class="btn" id="open-panel">Open in panel</button>
                            <button class="btn" id="open-window">Open in window</button>
                        </div>
                    </div>

                    <div class="card">
                        <strong>Module status</strong>
                        <small id="module-status">Loaded: divisor</small>
                    </div>

                    <div class="card">
                        <strong>Notes</strong>
                        <small>Drop a PDF to start. If a submodule exists at /submodules/{name}.html it will be loaded into the iframe.</small>
                    </div>
                </div>

                <div class="iframe-wrap" id="module-stage">
                    <iframe id="module-frame" src="submodules/divisor.html" title="PDF module"></iframe>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Minimal client-side module loader + file relay
        (function(){
            const modulesNav = document.getElementById('modules');
            const buttons = modulesNav.querySelectorAll('button[data-module]');
            const frame = document.getElementById('module-frame');
            const activeLabel = document.getElementById('activeModule');
            const status = document.getElementById('module-status');
            const fileInput = document.getElementById('file');
            const dropzone = document.getElementById('dropzone');
            const fileName = document.getElementById('file-name');
            const clearBtn = document.getElementById('clear-file');
            const openInNew = document.getElementById('open-in-new');
            const openWindowBtn = document.getElementById('open-window');
            const openPanelBtn = document.getElementById('open-panel');

            let currentModule = 'divisor';
            let uploaded = null; // File object
            let objectUrl = null;
            let externalWindow = null;

            function setActive(module){
                currentModule = module;
                buttons.forEach(b => b.classList.toggle('active', b.dataset.module === module));
                frame.src = 'submodules/' + module + '.html';
                activeLabel.textContent = module[0].toUpperCase() + module.slice(1);
                status.textContent = 'Loaded: ' + module;
            }

            modulesNav.addEventListener('click', e => {
                const btn = e.target.closest('button[data-module]');
                if(!btn) return;
                setActive(btn.dataset.module);
            });

            // File handling
            function relayFileToModule(){
                if(!uploaded) return;
                if(objectUrl) URL.revokeObjectURL(objectUrl);
                objectUrl = URL.createObjectURL(uploaded);
                // If iframe is loaded, postMessage the URL and filename
                const payload = {type:'file', url: objectUrl, name: uploaded.name, size: uploaded.size};
                // send to iframe and to any external window
                try { frame.contentWindow.postMessage(payload, '*'); } catch(e){}
                if(externalWindow && !externalWindow.closed){
                    try { externalWindow.postMessage(payload, '*'); } catch(e){}
                }
            }

            fileInput.addEventListener('change', e => {
                if(!e.target.files || !e.target.files[0]) return;
                uploaded = e.target.files[0];
                fileName.textContent = uploaded.name;
                relayFileToModule();
            });

            // drag & drop
            ['dragenter','dragover','dragleave','drop'].forEach(ev => {
                dropzone.addEventListener(ev, e => e.preventDefault());
            });
            dropzone.addEventListener('drop', e => {
                const f = e.dataTransfer.files && e.dataTransfer.files[0];
                if(f && f.type === 'application/pdf'){
                    uploaded = f;
                    fileName.textContent = f.name;
                    relayFileToModule();
                } else {
                    alert('Please drop a PDF file.');
                }
            });

            clearBtn.addEventListener('click', () => {
                uploaded = null;
                fileName.textContent = 'No file selected';
                if(objectUrl){ URL.revokeObjectURL(objectUrl); objectUrl = null; }
                // notify modules
                const msg = {type:'clear'};
                try { frame.contentWindow.postMessage(msg, '*'); } catch(e){}
                if(externalWindow && !externalWindow.closed) externalWindow.postMessage(msg, '*');
            });

            // open active module in a new window
            openInNew.addEventListener('click', () => {
                const url = 'submodules/' + currentModule + '.html';
                window.open(url, '_blank');
            });

            openWindowBtn.addEventListener('click', () => {
                const url = 'submodules/' + currentModule + '.html';
                externalWindow = window.open(url, 'pdf-module-' + currentModule, 'width=1000,height=700');
                // send file a short time later (external window needs to load)
                setTimeout(() => { if(uploaded) relayFileToModule(); }, 600);
            });

            openPanelBtn.addEventListener('click', () => {
                setActive(currentModule);
            });

            // receive messages from modules (e.g., requests)
            window.addEventListener('message', e => {
                const msg = e.data || {};
                if(msg && msg.type === 'request-file'){
                    // modules can ask for the current file
                    relayFileToModule();
                }
            });

            // toggle theme (very simple)
            document.getElementById('toggle-theme').addEventListener('click', () => {
                // For now we only support dark, placeholder for future light mode
                alert('Theme toggle placeholder — implement light mode here if desired.');
            });

            // If the iframe is already loaded and a file exists, relay it
            frame.addEventListener('load', () => {
                if(uploaded) relayFileToModule();
            });

            // initialize
            setActive('divisor');
        })();
    </script>
</body>
</html></button>