<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF to Image ‚Äî PDF for Humans</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        const { useState, useRef } = React;

        const App = () => {
            const [file, setFile] = useState(null);
            const [numPages, setNumPages] = useState(0);
            const [format, setFormat] = useState('png');
            const [dpi, setDpi] = useState(150);
            const [selectedPages, setSelectedPages] = useState('all');
            const [status, setStatus] = useState('idle');
            const [progress, setProgress] = useState(0);
            const [previews, setPreviews] = useState([]);
            const dropRef = useRef(null);

            const handleFile = async (f) => {
                if (f && f.type === 'application/pdf') {
                    setFile(f);
                    setStatus('loading');

                    try {
                        const arrayBuffer = await f.arrayBuffer();
                        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                        setNumPages(pdf.numPages);

                        // Generate previews for first 6 pages
                        const previewPromises = [];
                        const pagesToPreview = Math.min(6, pdf.numPages);

                        for (let i = 1; i <= pagesToPreview; i++) {
                            previewPromises.push((async () => {
                                const page = await pdf.getPage(i);
                                const scale = 0.3;
                                const viewport = page.getViewport({ scale });
                                const canvas = document.createElement('canvas');
                                const context = canvas.getContext('2d');
                                canvas.height = viewport.height;
                                canvas.width = viewport.width;
                                await page.render({ canvasContext: context, viewport }).promise;
                                return { pageNum: i, dataUrl: canvas.toDataURL() };
                            })());
                        }

                        const generatedPreviews = await Promise.all(previewPromises);
                        setPreviews(generatedPreviews);
                        setStatus('idle');
                    } catch (err) {
                        console.error(err);
                        setStatus('error');
                    }
                }
            };

            const convert = async () => {
                if (!file) return;

                setStatus('processing');
                setProgress(0);

                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                    const zip = new JSZip();
                    const scale = dpi / 72;

                    const pagesToConvert = selectedPages === 'all'
                        ? Array.from({ length: pdf.numPages }, (_, i) => i + 1)
                        : selectedPages.split(',').map(s => parseInt(s.trim())).filter(n => n > 0 && n <= pdf.numPages);

                    for (let i = 0; i < pagesToConvert.length; i++) {
                        const pageNum = pagesToConvert[i];
                        setProgress(Math.round((i / pagesToConvert.length) * 100));

                        const page = await pdf.getPage(pageNum);
                        const viewport = page.getViewport({ scale });
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;

                        await page.render({ canvasContext: context, viewport }).promise;

                        const mimeType = format === 'png' ? 'image/png' : 'image/jpeg';
                        const quality = format === 'jpg' ? 0.92 : undefined;
                        const dataUrl = canvas.toDataURL(mimeType, quality);
                        const base64 = dataUrl.split(',')[1];

                        const filename = `page_${String(pageNum).padStart(3, '0')}.${format}`;
                        zip.file(filename, base64, { base64: true });
                    }

                    setProgress(100);
                    const content = await zip.generateAsync({ type: 'blob' });
                    const zipName = file.name.replace('.pdf', `_images.zip`);
                    window.saveAs(content, zipName);

                    setStatus('success');
                } catch (err) {
                    console.error(err);
                    setStatus('error');
                }
            };

            return (
                <div className="min-h-screen p-6">
                    <div className="max-w-4xl mx-auto">
                        {/* Header */}
                        <a href="../index.html" className="inline-flex items-center gap-2 text-purple-300 hover:text-white mb-4 transition-colors">
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                            </svg>
                            Back to Tools
                        </a>
                        <h1 className="text-3xl font-bold text-white mb-2">PDF to Image</h1>
                        <p className="text-slate-400 mb-8">Convert PDF pages to high-quality images.</p>

                        {!file ? (
                            <div
                                ref={dropRef}
                                onDrop={(e) => { e.preventDefault(); handleFile(e.dataTransfer.files[0]); }}
                                onDragOver={(e) => e.preventDefault()}
                                onClick={() => document.getElementById('file-input').click()}
                                className="border-2 border-dashed border-slate-600 rounded-2xl p-12 text-center transition-all hover:border-purple-500 cursor-pointer bg-slate-800/50 backdrop-blur"
                            >
                                <div className="text-6xl mb-4">üñºÔ∏è</div>
                                <p className="text-white font-medium mb-2">Drop PDF here or click to browse</p>
                                <input
                                    id="file-input"
                                    type="file"
                                    accept="application/pdf"
                                    className="hidden"
                                    onChange={(e) => handleFile(e.target.files[0])}
                                />
                            </div>
                        ) : (
                            <div className="space-y-6">
                                {/* File Info & Options */}
                                <div className="bg-slate-800/80 backdrop-blur rounded-2xl p-6 border border-slate-700">
                                    <div className="flex items-center justify-between mb-6">
                                        <div>
                                            <p className="text-white font-medium">{file.name}</p>
                                            <p className="text-slate-400 text-sm">{numPages} pages</p>
                                        </div>
                                        <button
                                            onClick={() => { setFile(null); setPreviews([]); setStatus('idle'); }}
                                            className="text-slate-400 hover:text-white text-sm"
                                        >
                                            Change file
                                        </button>
                                    </div>

                                    {/* Previews */}
                                    {previews.length > 0 && (
                                        <div className="mb-6">
                                            <p className="text-sm text-slate-300 mb-3">Preview</p>
                                            <div className="grid grid-cols-3 sm:grid-cols-6 gap-2">
                                                {previews.map(p => (
                                                    <div key={p.pageNum} className="relative">
                                                        <img src={p.dataUrl} alt={`Page ${p.pageNum}`} className="rounded border border-slate-600 w-full" />
                                                        <span className="absolute bottom-1 right-1 text-xs bg-black/50 px-1 rounded text-white">{p.pageNum}</span>
                                                    </div>
                                                ))}
                                                {numPages > 6 && (
                                                    <div className="flex items-center justify-center bg-slate-700/50 rounded border border-slate-600 text-slate-400 text-sm">
                                                        +{numPages - 6} more
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    )}

                                    {/* Options */}
                                    <div className="grid sm:grid-cols-3 gap-4 mb-6">
                                        <div>
                                            <label className="text-sm text-slate-300 mb-2 block">Format</label>
                                            <select
                                                value={format}
                                                onChange={(e) => setFormat(e.target.value)}
                                                className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-purple-500"
                                            >
                                                <option value="png">PNG (Best quality)</option>
                                                <option value="jpg">JPG (Smaller size)</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="text-sm text-slate-300 mb-2 block">Quality (DPI)</label>
                                            <select
                                                value={dpi}
                                                onChange={(e) => setDpi(parseInt(e.target.value))}
                                                className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-purple-500"
                                            >
                                                <option value="72">72 DPI (Screen)</option>
                                                <option value="150">150 DPI (Standard)</option>
                                                <option value="300">300 DPI (High quality)</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="text-sm text-slate-300 mb-2 block">Pages</label>
                                            <input
                                                type="text"
                                                value={selectedPages}
                                                onChange={(e) => setSelectedPages(e.target.value)}
                                                placeholder="all or 1,2,5"
                                                className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-purple-500"
                                            />
                                        </div>
                                    </div>

                                    {/* Progress */}
                                    {status === 'processing' && (
                                        <div className="mb-4">
                                            <div className="flex justify-between text-sm text-slate-300 mb-2">
                                                <span>Converting...</span>
                                                <span>{progress}%</span>
                                            </div>
                                            <div className="h-2 bg-slate-700 rounded-full overflow-hidden">
                                                <div
                                                    className="h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all"
                                                    style={{ width: `${progress}%` }}
                                                ></div>
                                            </div>
                                        </div>
                                    )}

                                    {/* Convert Button */}
                                    <button
                                        onClick={convert}
                                        disabled={status === 'processing'}
                                        className="w-full py-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-semibold rounded-xl shadow-lg shadow-purple-500/25 transition-all disabled:opacity-50"
                                    >
                                        {status === 'processing' ? 'Converting...' : status === 'success' ? '‚úì Download Started' : 'Convert to Images'}
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>