<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rotate PDF â€” PDF for Humans</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-slate-900 via-cyan-900 to-slate-900 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        const { useState, useEffect } = React;

        const App = () => {
            const [file, setFile] = useState(null);
            const [pdfData, setPdfData] = useState(null);
            const [pages, setPages] = useState([]);
            const [status, setStatus] = useState('idle');

            const handleFile = async (f) => {
                if (!f || f.type !== 'application/pdf') return;

                setFile(f);
                setStatus('loading');

                try {
                    const arrayBuffer = await f.arrayBuffer();
                    setPdfData(arrayBuffer);

                    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer.slice(0) }).promise;
                    const pageInfos = [];

                    for (let i = 1; i <= pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const scale = 0.3;
                        const viewport = page.getViewport({ scale });
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = viewport.width;
                        canvas.height = viewport.height;
                        await page.render({ canvasContext: ctx, viewport }).promise;

                        pageInfos.push({
                            pageNum: i,
                            rotation: 0,
                            preview: canvas.toDataURL()
                        });
                    }

                    setPages(pageInfos);
                    setStatus('idle');
                } catch (err) {
                    console.error(err);
                    setStatus('error');
                }
            };

            const rotatePage = (pageNum, degrees) => {
                setPages(prev => prev.map(p =>
                    p.pageNum === pageNum
                        ? { ...p, rotation: (p.rotation + degrees + 360) % 360 }
                        : p
                ));
            };

            const rotateAll = (degrees) => {
                setPages(prev => prev.map(p => ({
                    ...p,
                    rotation: (p.rotation + degrees + 360) % 360
                })));
            };

            const applyRotation = async () => {
                if (!pdfData) return;

                setStatus('processing');

                try {
                    const { PDFDocument, degrees } = window.PDFLib;
                    const pdfDoc = await PDFDocument.load(pdfData);
                    const pdfPages = pdfDoc.getPages();

                    pages.forEach((pageInfo, idx) => {
                        if (pageInfo.rotation !== 0) {
                            const page = pdfPages[idx];
                            const currentRotation = page.getRotation().angle;
                            page.setRotation(degrees(currentRotation + pageInfo.rotation));
                        }
                    });

                    const pdfBytes = await pdfDoc.save();
                    const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                    const name = file.name.replace('.pdf', '_rotated.pdf');
                    window.saveAs(blob, name);

                    setStatus('success');
                    setTimeout(() => setStatus('idle'), 3000);
                } catch (err) {
                    console.error(err);
                    setStatus('error');
                }
            };

            return (
                <div className="min-h-screen p-6">
                    <div className="max-w-6xl mx-auto">
                        <a href="../index.html" className="inline-flex items-center gap-2 text-cyan-300 hover:text-white mb-4 transition-colors">
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                            </svg>
                            Back to Tools
                        </a>
                        <h1 className="text-3xl font-bold text-white mb-2">Rotate PDF</h1>
                        <p className="text-slate-400 mb-8">Rotate individual pages or the entire document.</p>

                        {!file ? (
                            <div
                                onDrop={(e) => { e.preventDefault(); handleFile(e.dataTransfer.files[0]); }}
                                onDragOver={(e) => e.preventDefault()}
                                onClick={() => document.getElementById('file-input').click()}
                                className="border-2 border-dashed border-slate-600 rounded-2xl p-12 text-center transition-all hover:border-cyan-500 cursor-pointer bg-slate-800/50 backdrop-blur"
                            >
                                <div className="text-6xl mb-4">ðŸ”„</div>
                                <p className="text-white font-medium mb-2">Drop PDF here or click to browse</p>
                                <input
                                    id="file-input"
                                    type="file"
                                    accept="application/pdf"
                                    className="hidden"
                                    onChange={(e) => handleFile(e.target.files[0])}
                                />
                            </div>
                        ) : (
                            <div className="space-y-6">
                                {/* Controls */}
                                <div className="bg-slate-800/80 backdrop-blur rounded-2xl p-4 border border-slate-700 flex flex-wrap gap-4 items-center justify-between">
                                    <div>
                                        <p className="text-white font-medium">{file.name}</p>
                                        <p className="text-slate-400 text-sm">{pages.length} pages</p>
                                    </div>
                                    <div className="flex gap-2">
                                        <button onClick={() => rotateAll(-90)} className="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors">
                                            â†º Rotate All Left
                                        </button>
                                        <button onClick={() => rotateAll(90)} className="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors">
                                            â†» Rotate All Right
                                        </button>
                                        <button
                                            onClick={() => { setFile(null); setPages([]); setPdfData(null); }}
                                            className="px-4 py-2 text-slate-400 hover:text-white transition-colors"
                                        >
                                            Change file
                                        </button>
                                    </div>
                                </div>

                                {/* Pages Grid */}
                                {status === 'loading' ? (
                                    <div className="flex justify-center py-12">
                                        <div className="w-8 h-8 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin"></div>
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                                        {pages.map(page => (
                                            <div key={page.pageNum} className="bg-slate-800/80 backdrop-blur rounded-xl p-3 border border-slate-700">
                                                <div className="relative mb-3 flex justify-center">
                                                    <img
                                                        src={page.preview}
                                                        alt={`Page ${page.pageNum}`}
                                                        className="max-h-40 rounded border border-slate-600 transition-transform"
                                                        style={{ transform: `rotate(${page.rotation}deg)` }}
                                                    />
                                                </div>
                                                <div className="flex items-center justify-between">
                                                    <span className="text-slate-400 text-sm">Page {page.pageNum}</span>
                                                    <div className="flex gap-1">
                                                        <button
                                                            onClick={() => rotatePage(page.pageNum, -90)}
                                                            className="w-8 h-8 bg-slate-700 hover:bg-cyan-600 text-white rounded transition-colors text-sm"
                                                        >â†º</button>
                                                        <button
                                                            onClick={() => rotatePage(page.pageNum, 90)}
                                                            className="w-8 h-8 bg-slate-700 hover:bg-cyan-600 text-white rounded transition-colors text-sm"
                                                        >â†»</button>
                                                    </div>
                                                </div>
                                                {page.rotation !== 0 && (
                                                    <p className="text-cyan-400 text-xs mt-1 text-center">{page.rotation}Â°</p>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                )}

                                {/* Apply Button */}
                                {pages.some(p => p.rotation !== 0) && (
                                    <div className="text-center">
                                        <button
                                            onClick={applyRotation}
                                            disabled={status === 'processing'}
                                            className="px-8 py-4 bg-gradient-to-r from-cyan-600 to-teal-600 hover:from-cyan-500 hover:to-teal-500 text-white font-semibold rounded-xl shadow-lg shadow-cyan-500/25 transition-all disabled:opacity-50"
                                        >
                                            {status === 'processing' ? 'Applying...' : status === 'success' ? 'âœ“ Download Started' : 'Apply Rotation & Download'}
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>