<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compress PDF â€” PDF for Humans</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-slate-900 via-green-900 to-slate-900 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef } = React;

        const App = () => {
            const [file, setFile] = useState(null);
            const [originalSize, setOriginalSize] = useState(0);
            const [compressedSize, setCompressedSize] = useState(0);
            const [quality, setQuality] = useState('medium');
            const [status, setStatus] = useState('idle');
            const [statusMsg, setStatusMsg] = useState('');
            const dropRef = useRef(null);

            const handleFile = (f) => {
                if (f && f.type === 'application/pdf') {
                    setFile(f);
                    setOriginalSize(f.size);
                    setCompressedSize(0);
                    setStatus('idle');
                }
            };

            const handleDrop = (e) => {
                e.preventDefault();
                dropRef.current?.classList.remove('drag-over');
                handleFile(e.dataTransfer.files[0]);
            };

            const compress = async () => {
                if (!file) return;

                setStatus('processing');
                setStatusMsg('Loading PDF...');

                try {
                    const { PDFDocument } = window.PDFLib;
                    const arrayBuffer = await file.arrayBuffer();
                    const pdfDoc = await PDFDocument.load(arrayBuffer, {
                        ignoreEncryption: true,
                        updateMetadata: false
                    });

                    setStatusMsg('Optimizing PDF structure...');

                    // Remove metadata to reduce size
                    pdfDoc.setTitle('');
                    pdfDoc.setAuthor('');
                    pdfDoc.setSubject('');
                    pdfDoc.setKeywords([]);
                    pdfDoc.setProducer('PDF for Humans');
                    pdfDoc.setCreator('');

                    // Quality settings affect object streams
                    const options = {
                        useObjectStreams: quality !== 'low',
                        addDefaultPage: false,
                        objectsPerTick: quality === 'high' ? 50 : quality === 'medium' ? 100 : 200,
                    };

                    setStatusMsg('Saving compressed PDF...');
                    const pdfBytes = await pdfDoc.save(options);

                    setCompressedSize(pdfBytes.length);

                    const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                    const compressedName = file.name.replace('.pdf', '_compressed.pdf');
                    window.saveAs(blob, compressedName);

                    setStatus('success');
                    setStatusMsg('Compression complete!');
                } catch (err) {
                    console.error(err);
                    setStatus('error');
                    setStatusMsg('Error: ' + err.message);
                }
            };

            const formatSize = (bytes) => {
                if (bytes < 1024) return bytes + ' B';
                if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
                return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
            };

            const reduction = compressedSize > 0 ? Math.round((1 - compressedSize / originalSize) * 100) : 0;

            return (
                <div className="min-h-screen p-6">
                    <div className="max-w-2xl mx-auto">
                        {/* Header */}
                        <a href="../index.html" className="inline-flex items-center gap-2 text-green-300 hover:text-white mb-4 transition-colors">
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                            </svg>
                            Back to Tools
                        </a>
                        <h1 className="text-3xl font-bold text-white mb-2">Compress PDF</h1>
                        <p className="text-slate-400 mb-8">Reduce PDF file size while maintaining quality.</p>

                        {/* Drop Zone */}
                        {!file ? (
                            <div
                                ref={dropRef}
                                onDrop={handleDrop}
                                onDragOver={(e) => { e.preventDefault(); dropRef.current?.classList.add('drag-over'); }}
                                onDragLeave={(e) => { e.preventDefault(); dropRef.current?.classList.remove('drag-over'); }}
                                onClick={() => document.getElementById('file-input').click()}
                                className="border-2 border-dashed border-slate-600 rounded-2xl p-12 text-center transition-all hover:border-green-500 cursor-pointer bg-slate-800/50 backdrop-blur"
                            >
                                <div className="text-6xl mb-4">ðŸ“¦</div>
                                <p className="text-white font-medium mb-2">Drop PDF here or click to browse</p>
                                <input
                                    id="file-input"
                                    type="file"
                                    accept="application/pdf"
                                    className="hidden"
                                    onChange={(e) => handleFile(e.target.files[0])}
                                />
                            </div>
                        ) : (
                            <div className="space-y-6">
                                {/* File Info */}
                                <div className="bg-slate-800/80 backdrop-blur rounded-2xl p-6 border border-slate-700">
                                    <div className="flex items-center justify-between mb-4">
                                        <div className="flex items-center gap-4">
                                            <div className="text-4xl">ðŸ“„</div>
                                            <div>
                                                <p className="text-white font-medium truncate max-w-xs">{file.name}</p>
                                                <p className="text-slate-400 text-sm">Original: {formatSize(originalSize)}</p>
                                            </div>
                                        </div>
                                        <button
                                            onClick={() => { setFile(null); setCompressedSize(0); setStatus('idle'); }}
                                            className="text-slate-400 hover:text-white"
                                        >
                                            Change file
                                        </button>
                                    </div>

                                    {/* Quality Selector */}
                                    <div className="mb-6">
                                        <label className="text-sm text-slate-300 mb-3 block">Compression Level</label>
                                        <div className="grid grid-cols-3 gap-3">
                                            {[
                                                { value: 'low', label: 'Maximum', desc: 'Smallest size' },
                                                { value: 'medium', label: 'Balanced', desc: 'Recommended' },
                                                { value: 'high', label: 'Minimum', desc: 'Best quality' },
                                            ].map(opt => (
                                                <button
                                                    key={opt.value}
                                                    onClick={() => setQuality(opt.value)}
                                                    className={`p-4 rounded-xl border-2 transition-all text-left ${quality === opt.value
                                                            ? 'border-green-500 bg-green-500/10'
                                                            : 'border-slate-600 hover:border-slate-500'
                                                        }`}
                                                >
                                                    <p className="text-white font-medium">{opt.label}</p>
                                                    <p className="text-slate-400 text-sm">{opt.desc}</p>
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Results */}
                                    {compressedSize > 0 && (
                                        <div className="bg-green-500/10 border border-green-500/30 rounded-xl p-4 mb-6">
                                            <div className="flex justify-between items-center">
                                                <div>
                                                    <p className="text-green-400 font-medium">Compressed Size</p>
                                                    <p className="text-white text-2xl font-bold">{formatSize(compressedSize)}</p>
                                                </div>
                                                <div className="text-right">
                                                    <p className="text-green-400 font-medium">Reduction</p>
                                                    <p className="text-white text-2xl font-bold">{reduction}%</p>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {/* Compress Button */}
                                    <button
                                        onClick={compress}
                                        disabled={status === 'processing'}
                                        className="w-full py-4 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-semibold rounded-xl shadow-lg shadow-green-500/25 transition-all disabled:opacity-50"
                                    >
                                        {status === 'processing' ? (
                                            <span className="flex items-center justify-center gap-2">
                                                <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                                {statusMsg}
                                            </span>
                                        ) : status === 'success' ? (
                                            'âœ“ Download Started'
                                        ) : (
                                            'Compress PDF'
                                        )}
                                    </button>

                                    {status === 'error' && (
                                        <p className="mt-4 text-red-400 text-center">{statusMsg}</p>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Note */}
                        <p className="text-center text-slate-500 text-sm mt-8">
                            Note: Compression results vary based on PDF content. Documents with images typically compress better.
                        </p>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>